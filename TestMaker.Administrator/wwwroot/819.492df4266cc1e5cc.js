"use strict";(self.webpackChunkTestMaker_Administrator=self.webpackChunkTestMaker_Administrator||[]).push([[819],{5819:(L,T,o)=>{o.r(T),o.d(T,{TestModule:()=>G});var w=o(6895),D=o(7059),S=o(529),g=o(490),a=o(4006),v=o(5434),l=o(8055),k=o(778),d=o(9782),p=(()=>{return(i=p||(p={}))[i.MultipleChoiceQuestion=1]="MultipleChoiceQuestion",i[i.BlankFillingQuestion=2]="BlankFillingQuestion",i[i.SortingQuestion=3]="SortingQuestion",i[i.MatchingQuestion=4]="MatchingQuestion",p;var i})();const J=[{title:"Ch\u1ecdn \u0111\xe1p \xe1n",value:p.MultipleChoiceQuestion},{title:"\u0110i\u1ec1n ch\u1ed7 tr\u1ed1ng",value:p.BlankFillingQuestion},{title:"S\u1eafp x\u1ebfp",value:p.SortingQuestion},{title:"N\u1ed1i",value:p.MatchingQuestion}];var Q=o(7347),f=o(414),C=o(9836);class M{constructor(t){this.form=t}getQuestionForCreating(){const t=this.form.value;return{name:t.name,contentAsJson:JSON.stringify({question:t.question,isFromAPrivateCollection:t.isFromAPrivateCollection,blanks:t.blanks}),sectionId:t.sectionId,type:t.type}}getQuestionForEditing(){const t=this.form.value;return{questionId:t.questionId,name:t.name,contentAsJson:JSON.stringify({question:t.question,isFromAPrivateCollection:t.isFromAPrivateCollection,blanks:t.blanks}),sectionId:t.sectionId,type:t.type}}changeForm(t){this.form.removeControl("question"),this.form.removeControl("isFromAPrivateCollection"),this.form.removeControl("answers"),this.form.removeControl("blanks");let e=null;t&&(e=JSON.parse(t.contentAsJson)),this.form.addControl("isFromAPrivateCollection",new Q.w({title:"Ngu\u1ed3n t\u1eeb",options:[{title:"Ri\xeang t\u1eebng t\u1eeb",value:!0},{title:"Nh\xf3m chung",value:!1}],order:3,formState:!!e&&e.isFromAPrivateCollection,events:{change:n=>{this.changeTypeOfCollection()}}})),this.form.addControl("question",new f.l({title:"C\xe2u h\u1ecfi",order:4,events:{change:(n,u)=>{this.changeTypeOfCollection()}},formState:e?e.question:""})),e&&e.isFromAPrivateCollection&&this.form.addControl("blanks",new C.G({title:"C\xe2u tr\u1ea3 l\u1eddi",columns:{position:new l.y({title:"V\u1ecb tr\xed",order:1}),answer:new l.y({title:"C\xe2u tr\u1ea3 l\u1eddi",order:2})},order:5,formState:e?e.blanks:[]}))}changeTypeOfCollection(){const e=this.form.controls.question;if(this.form.controls.isFromAPrivateCollection.value){const n=this.buildAnswersValueFromQuestionValue(e.value);this.addBlanks([]);const u=this.form.controls.blanks,r=u.value;e.value.match(/blank_[0->9]*\(/g),n.forEach(c=>{const m=r.findIndex(I=>I.position===c.position);m>=0?r[m].answer.indexOf(c.answer)<0&&(r[m].answer+=`,${c.answer}`):(u.addFormGroup(),r.push({position:c.position,answer:c.answer}))}),u.setValue(r)}else this.form.removeControl("blanks")}addBlanks(t){this.form.controls.blanks||this.form.addControl("blanks",new C.G({title:"Ch\u1ed7 \u0111i\u1ec1n",columns:{position:new l.y({title:"V\u1ecb tr\xed",order:1}),answer:new l.y({title:"C\xe2u tr\u1ea3 l\u1eddi",order:2})},order:4,formState:t}))}buildAnswersValueFromQuestionValue(t){const e=[],n=t.match(/blank_[0->9]*\(/g);function u(r){let c="";for(let m=t.indexOf(r);m<t.length;m++){const I=t.charAt(m);if("("===I)c="";else{if(")"===I)return c;c+=I}}return c}return n&&n.forEach(r=>{e.push({position:r.replace("(",""),answer:u(r)})}),e}}class x{constructor(t){this.form=t}getQuestionForCreating(){const t=this.form.value;return{name:t.name,contentAsJson:JSON.stringify({question:t.question,answers:t.answers}),sectionId:t.sectionId,type:t.type}}getQuestionForEditing(){const t=this.form.value;return{questionId:t.questionId,name:t.name,contentAsJson:JSON.stringify({question:t.question,answers:t.answers}),sectionId:t.sectionId,type:t.type}}changeForm(t){this.form.removeControl("question"),this.form.removeControl("isFromAPrivateCollection"),this.form.removeControl("answers"),this.form.removeControl("blanks");let e=null;t&&(e=JSON.parse(t.contentAsJson)),this.form.addControl("question",new f.l({title:"C\xe2u h\u1ecfi",order:3,formState:e?e.question:""})),this.form.addControl("answers",new C.G({title:"C\xe2u tr\u1ea3 l\u1eddi",columns:{from:new l.y({title:"B\u1eaft \u0111\u1ea7u",order:1,validatorOrOpts:a.kI.required}),target:new l.y({title:"K\u1ebft th\xfac",order:2,validatorOrOpts:a.kI.required})},order:4,formState:e?e.answers:[]}))}}class B{constructor(t){this.form=t,this.isCorrectOptions=[{value:!0,title:"\u0110\xfang"},{value:!1,title:"Sai"}]}getQuestionForCreating(){const t=this.form.value;return{name:t.name,contentAsJson:JSON.stringify({question:t.question,answers:t.answers}),sectionId:t.sectionId,type:t.type}}getQuestionForEditing(){const t=this.form.value;return{questionId:t.questionId,name:t.name,contentAsJson:JSON.stringify({question:t.question,answers:t.answers}),sectionId:t.sectionId,type:t.type}}changeForm(t){this.form.removeControl("question"),this.form.removeControl("isFromAPrivateCollection"),this.form.removeControl("answers"),this.form.removeControl("blanks");let e=null;if(t){const n=JSON.parse(t.contentAsJson);e={questionId:t.questionId,name:t.name,sectionId:t.sectionId,type:t.type,question:n.question,answers:n.answers}}this.form.addControl("question",new f.l({title:"C\xe2u h\u1ecfi",order:3,formState:e?e.question:""})),this.form.addControl("answers",new C.G({title:"C\xe2u tr\u1ea3 l\u1eddi",columns:{answer:new l.y({title:"C\xe2u tr\u1ea3 l\u1eddi",order:1,validatorOrOpts:a.kI.required}),isCorrect:new Q.w({title:"L\xe0 c\xe2u tr\u1ea3 l\u1eddi \u0111\xfang",options:this.isCorrectOptions,order:1,formState:!1,validatorOrOpts:a.kI.required})},formState:e?e.answers:[],order:4}))}}class N{constructor(t){this.form=t}getQuestionForCreating(){const t=this.form.value;return{name:t.name,contentAsJson:JSON.stringify({question:t.question,answers:t.answers}),sectionId:t.sectionId,type:t.type}}getQuestionForEditing(){const t=this.form.value;return{questionId:t.questionId,name:t.name,contentAsJson:JSON.stringify({question:t.question,answers:t.answers}),sectionId:t.sectionId,type:t.type}}changeForm(t){this.form.removeControl("question"),this.form.removeControl("isFromAPrivateCollection"),this.form.removeControl("answers"),this.form.removeControl("blanks");let e=null;t&&(e=JSON.parse(t.contentAsJson)),this.form.addControl("question",new f.l({title:"C\xe2u h\u1ecfi",order:3,formState:e?e.question:""})),this.form.addControl("answers",new C.G({title:"C\xe2u tr\u1ea3 l\u1eddi",columns:{answer:new l.y({title:"C\xe2u tr\u1ea3 l\u1eddi",order:1,validatorOrOpts:a.kI.required}),position:new l.y({title:"S\u1ed1 th\u1ee9 t\u1ef1",order:2,validatorOrOpts:a.kI.required})},order:4,formState:e?e.answers:[]}))}}var s=o(4650),$=o(9905),y=o(5715);let H=(()=>{class i{constructor(e,n){this.router=e,this.questionsService=n,this.pageHelper=new d.M("/test/question"),this.questionHelper=null,this.formConfig={id:"questionForm",title:this.formTitle,buttons:this.buttons,form:new a.cw({questionId:new v.W(""),name:new l.y({title:"T\xean",order:1,validatorOrOpts:a.kI.required}),type:new k.i({title:"Ki\u1ec3u c\xe2u h\u1ecfi",options:J,order:2,formState:p.MultipleChoiceQuestion,events:{change:u=>{this.updateQuestionHelper(),this.questionHelper.changeForm()}},validatorOrOpts:a.kI.required}),sectionId:new v.W(this.sectionId)})}}get sectionId(){return new URL(location.href.replace("/#","")).searchParams.get("sectionId")}get questionId(){const e=location.href.split("?")[0].split("/");return e[e.length-1]}get formTitle(){return this.pageHelper.isCreatingPage?"Th\xeam c\xe2u h\u1ecfi":this.pageHelper.isDetailsPage?"Th\xf4ng tin c\xe2u h\u1ecfi":"S\u1eeda c\xe2u h\u1ecfi"}get buttons(){return[{title:"Quay l\u1ea1i ph\u1ea7n ki\u1ec3m tra",link:{url:`/test/section-details/${this.sectionId}`}},this.pageHelper.isEditingPage?{title:"Quay l\u1ea1i",link:{url:this.pageHelper.getDetailsPage(this.questionId),queryParams:{sectionId:this.sectionId}}}:null,{title:this.pageHelper.isCreatingPage?"Th\xeam":this.pageHelper.isDetailsPage?"S\u1eeda":"L\u01b0u",link:this.pageHelper.isDetailsPage?{url:this.pageHelper.getEditingPage(this.questionId),queryParams:{sectionId:this.sectionId}}:null,event:this.pageHelper.isDetailsPage?null:e=>this.submitEvent(e)}]}ngOnInit(){this.pageHelper.isCreatingPage?(this.updateQuestionHelper(),this.questionHelper.changeForm()):this.questionsService.getQuestion(this.questionId).subscribe(e=>{this.formConfig.form.setValue({questionId:e.questionId,name:e.name,type:e.type,sectionId:e.sectionId}),this.updateQuestionHelper(),this.questionHelper.changeForm(e),this.pageHelper.isDetailsPage&&this.formConfig.form.disable()})}submitEvent(e){this.createOrEditQuestion()}createOrEditQuestion(){this.pageHelper.isCreatingPage&&this.questionsService.createQuestion(this.questionHelper.getQuestionForCreating()).subscribe(e=>{this.router.navigate([this.pageHelper.getDetailsPage(e.questionId)],{queryParams:{sectionId:e.sectionId}})}),this.pageHelper.isEditingPage&&this.questionsService.updateQuestion(this.questionHelper.getQuestionForEditing()).subscribe(()=>{this.router.navigate([this.pageHelper.getDetailsPage(this.questionId)],{queryParams:{sectionId:this.sectionId}})})}updateQuestionHelper(){switch(+this.formConfig.form.controls.type.value){case p.MultipleChoiceQuestion:this.questionHelper=new B(this.formConfig.form);break;case p.BlankFillingQuestion:this.questionHelper=new M(this.formConfig.form);break;case p.SortingQuestion:this.questionHelper=new N(this.formConfig.form);break;case p.MatchingQuestion:this.questionHelper=new x(this.formConfig.form)}}}return i.\u0275fac=function(e){return new(e||i)(s.Y36(g.F0),s.Y36($.w))},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-question"]],decls:1,vars:1,consts:[[3,"config"]],template:function(e,n){1&e&&s._UZ(0,"app-form",0),2&e&&s.Q6J("config",n.formConfig)},dependencies:[y.U],encapsulation:2}),i})();var P=o(1627);let F=(()=>{class i{constructor(e){this.router=e,this.pageHelper=new d.M("/test/question"),this.tableConfig={title:"Danh s\xe1ch c\xe2u h\u1ecfi",url:"api/Test/Admin/Questions",buttons:[{title:"Th\xeam",link:{url:this.pageHelper.getCreatingPage()}}],columns:[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[questionId]")}}]}}ngOnInit(){this.sectionId&&(this.tableConfig.url=`api/Test/Admin/Questions?sectionId=${this.sectionId}`,this.tableConfig.buttons=[{title:"Th\xeam",link:{url:this.pageHelper.getCreatingPage(),queryParams:{sectionId:this.sectionId}}}],this.tableConfig.columns=[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[questionId]"),queryParams:{sectionId:this.sectionId}}}])}}return i.\u0275fac=function(e){return new(e||i)(s.Y36(g.F0))},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-questions"]],inputs:{sectionId:"sectionId"},decls:2,vars:1,consts:[[3,"config"]],template:function(e,n){1&e&&(s.TgZ(0,"app-table",0),s._UZ(1,"app-table"),s.qZA()),2&e&&s.Q6J("config",n.tableConfig)},dependencies:[P.a],encapsulation:2}),i})();var A=o(3454);function Z(i,t){if(1&i&&(s.TgZ(0,"app-questions",2),s._UZ(1,"app-questions"),s.qZA()),2&i){const e=s.oxw();s.Q6J("sectionId",e.sectionId)}}let q=(()=>{class i{constructor(e,n,u){this.httpClient=e,this.router=n,this.testsService=u,this.pageHelper=new d.M("/test/section"),this.buttonBack={title:"Quay l\u1ea1i b\xe0i ki\u1ec3m tra",link:{url:`/test/test-details/${this.testId}`}},this.formTestId=new k.i({options:[],formState:this.testId,order:2,title:"B\xe0i ki\u1ec3m tra"}),this.formConfig={id:"sectionForm",title:this.formTitle,buttons:[this.buttonBack,this.pageHelper.isEditingPage?{title:"Quay l\u1ea1i",link:{url:this.pageHelper.getDetailsPage(this.sectionId)}}:null,{title:this.pageHelper.isCreatingPage?"Th\xeam":this.pageHelper.isDetailsPage?"S\u1eeda":"L\u01b0u",link:this.pageHelper.isDetailsPage?{url:this.pageHelper.getEditingPage(this.sectionId)}:null,event:this.pageHelper.isDetailsPage?null:r=>{if(this.pageHelper.isCreatingPage){const h=this.formConfig.form.value;h.sectionId=void 0,this.httpClient.post("api/Test/Admin/Sections",h).subscribe(c=>{this.router.navigate([this.pageHelper.getDetailsPage(c.data.sectionId)])})}this.pageHelper.isEditingPage&&this.httpClient.put(`api/Test/Admin/Sections/${this.sectionId}`,this.formConfig.form.value).subscribe(()=>{this.router.navigate([this.pageHelper.getDetailsPage(this.sectionId)])})}}],form:new a.cw({sectionId:new v.W(""),name:new l.y({title:"T\xean",order:1,validatorOrOpts:a.kI.required}),testId:this.formTestId})},this.testId=new URL(location.href.replace("/#","")).searchParams.get("testId")||"",this.formTestId.setValue(this.testId)}get isDetailsPage(){return this.pageHelper.isDetailsPage}get sectionId(){const e=location.href.split("?")[0].split("/");return e[e.length-1]}get formTitle(){return this.pageHelper.isCreatingPage?"Th\xeam ph\u1ea7n ki\u1ec3m tra":this.pageHelper.isDetailsPage?"Th\xf4ng tin ph\u1ea7n ki\u1ec3m tra":"S\u1eeda ph\u1ea7n ki\u1ec3m tra"}ngOnInit(){this.testsService.getTestsAsSelectOptions().subscribe(e=>{this.formTestId.params.options=e}),this.pageHelper.isCreatingPage||(this.httpClient.get(`api/Test/Admin/Sections/${this.sectionId}`).subscribe(e=>{this.testId=e.data.testId,this.formConfig.buttons[0].link&&(this.formConfig.buttons[0].link.url=`/test/test-details/${this.testId}`),this.formConfig.form.setValue(e.data)}),this.formTestId.disable()),this.pageHelper.isDetailsPage&&this.formConfig.form.disable()}}return i.\u0275fac=function(e){return new(e||i)(s.Y36(S.eN),s.Y36(g.F0),s.Y36(A.$x))},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-section"]],decls:2,vars:2,consts:[[3,"config"],[3,"sectionId",4,"ngIf"],[3,"sectionId"]],template:function(e,n){1&e&&(s._UZ(0,"app-form",0),s.YNc(1,Z,2,1,"app-questions",1)),2&e&&(s.Q6J("config",n.formConfig),s.xp6(1),s.Q6J("ngIf",n.isDetailsPage))},dependencies:[w.O5,y.U,F],encapsulation:2}),i})(),O=(()=>{class i{constructor(e){this.router=e,this.pageHelper=new d.M("/test/section"),this.addSectionButton={title:"Th\xeam",link:{url:this.pageHelper.getCreatingPage()}},this.tableConfig={title:"Danh s\xe1ch ph\u1ea7n ki\u1ec3m tra",url:"api/Test/Admin/Sections",buttons:[this.addSectionButton],columns:[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[sectionId]")}}]}}ngOnInit(){this.testId&&(this.tableConfig.url=`api/Test/Admin/Sections?testId=${this.testId}`,this.tableConfig.columns=[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[sectionId]")}}],this.addSectionButton.link={url:this.pageHelper.getCreatingPage(),queryParams:{testId:this.testId}})}}return i.\u0275fac=function(e){return new(e||i)(s.Y36(g.F0))},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-sections"]],inputs:{testId:"testId"},decls:2,vars:1,consts:[[3,"config"]],template:function(e,n){1&e&&(s.TgZ(0,"app-table",0),s._UZ(1,"app-table"),s.qZA()),2&e&&s.Q6J("config",n.tableConfig)},dependencies:[P.a],encapsulation:2}),i})();function E(i,t){if(1&i&&s._UZ(0,"app-sections",2),2&i){const e=s.oxw();s.Q6J("testId",e.testId)}}let b=(()=>{class i{constructor(e,n){this.router=e,this.testsService=n,this.pageHelper=new d.M("/test/test"),this.formConfig={id:"testForm",title:this.pageHelper.isCreatingPage?"Th\xeam b\xe0i ki\u1ec3m tra m\u1edbi":this.pageHelper.isDetailsPage?"Th\xf4ng tin b\xe0i ki\u1ec3m tra":"S\u1eeda b\xe0i ki\u1ec3m tra",buttons:[{title:"Danh s\xe1ch",link:{url:"/test/test-list"}},this.pageHelper.isEditingPage?{title:"Quay l\u1ea1i",link:{url:this.pageHelper.getDetailsPage(this.testId)}}:null,{title:this.pageHelper.isDetailsPage?"S\u1eeda":this.pageHelper.isEditingPage?"L\u01b0u":"Th\xeam",link:this.pageHelper.isDetailsPage?{url:this.pageHelper.getEditingPage(this.testId)}:null,event:this.pageHelper.isDetailsPage?null:u=>{const r=this.formConfig.form.value;this.pageHelper.isCreatingPage&&this.testsService.createTest({name:r.name,description:r.description}).subscribe(h=>{this.router.navigate([this.pageHelper.getDetailsPage(h.testId)])}),this.pageHelper.isEditingPage&&this.testsService.editTest({testId:r.testId,name:r.name,description:r.description}).subscribe(()=>{this.router.navigate([this.pageHelper.getDetailsPage(this.testId)])})}}],form:new a.cw({testId:new v.W(""),name:new l.y({title:"T\xean",order:1,validatorOrOpts:a.kI.required}),description:new f.l({title:"M\xf4 t\u1ea3",order:2})})}}get testId(){const e=location.href.split("/");return e[e.length-1]}get isDetailsPage(){return location.href.indexOf("/test/test-details/")>=0}ngOnInit(){this.pageHelper.isCreatingPage||this.testsService.getTest(this.testId).subscribe(e=>{this.formConfig.form.setValue(e)}),this.pageHelper.isDetailsPage&&this.formConfig.form.disable()}}return i.\u0275fac=function(e){return new(e||i)(s.Y36(g.F0),s.Y36(A.$x))},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-test"]],decls:2,vars:2,consts:[[3,"config"],[3,"testId",4,"ngIf"],[3,"testId"]],template:function(e,n){1&e&&(s._UZ(0,"app-form",0),s.YNc(1,E,1,1,"app-sections",1)),2&e&&(s.Q6J("config",n.formConfig),s.xp6(1),s.Q6J("ngIf",n.isDetailsPage))},dependencies:[w.O5,y.U,O],styles:["app-sections[_ngcontent-%COMP%]{margin-top:20px}"]}),i})();const V=[{path:"test-list",component:(()=>{class i{constructor(){this.pageHelper=new d.M("/test/test"),this.tableConfig={title:"Danh s\xe1ch b\xe0i ki\u1ec3m tra",url:"api/Test/Admin/Tests",buttons:[{title:"Th\xeam",link:{url:this.pageHelper.getCreatingPage()}}],columns:[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[testId]")}}]}}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-test"]],decls:1,vars:1,consts:[[3,"config"]],template:function(e,n){1&e&&s._UZ(0,"app-table",0),2&e&&s.Q6J("config",n.tableConfig)},dependencies:[P.a],encapsulation:2}),i})()},{path:"test-creating",component:b},{path:"test-details/:id",component:b},{path:"test-editing/:id",component:b},{path:"section-list",component:O},{path:"section-creating",component:q},{path:"section-details/:id",component:q},{path:"section-editing/:id",component:q},{path:"question-list",component:F},{path:"question-creating",component:H},{path:"question-details/:id",component:H},{path:"question-editing/:id",component:H}];let U=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=s.oAB({type:i}),i.\u0275inj=s.cJS({imports:[g.Bz.forChild(V),g.Bz]}),i})(),G=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=s.oAB({type:i}),i.\u0275inj=s.cJS({imports:[w.ez,U,D.u,S.JF]}),i})()}}]);