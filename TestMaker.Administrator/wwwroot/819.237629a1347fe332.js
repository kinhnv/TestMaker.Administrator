"use strict";(self.webpackChunkTestMaker_Administrator=self.webpackChunkTestMaker_Administrator||[]).push([[819],{5819:(z,Q,o)=>{o.r(Q),o.d(Q,{TestModule:()=>W});var C=o(6895),J=o(9368),S=o(529),g=o(490),a=o(4006),w=o(5434),l=o(8055),k=o(778),d=o(9782),p=(()=>{return(n=p||(p={}))[n.MultipleChoiceQuestion=1]="MultipleChoiceQuestion",n[n.BlankFillingQuestion=2]="BlankFillingQuestion",n[n.SortingQuestion=3]="SortingQuestion",n[n.MatchingQuestion=4]="MatchingQuestion",p;var n})();const D=[{title:"Ch\u1ecdn \u0111\xe1p \xe1n",value:p.MultipleChoiceQuestion},{title:"\u0110i\u1ec1n ch\u1ed7 tr\u1ed1ng",value:p.BlankFillingQuestion},{title:"S\u1eafp x\u1ebfp",value:p.SortingQuestion},{title:"N\u1ed1i",value:p.MatchingQuestion}];var A=o(7347),I=o(414),v=o(9836);class M{constructor(e){this.form=e}getQuestionForCreating(){const e=this.form.value;return{name:e.name,contentAsJson:JSON.stringify({question:e.question,isFromAPrivateCollection:e.isFromAPrivateCollection,blanks:e.blanks}),sectionId:e.sectionId,type:e.type}}getQuestionForEditing(){const e=this.form.value;return{questionId:e.questionId,name:e.name,contentAsJson:JSON.stringify({question:e.question,isFromAPrivateCollection:e.isFromAPrivateCollection,blanks:e.blanks}),sectionId:e.sectionId,type:e.type}}changeForm(e){this.form.removeControl("question"),this.form.removeControl("isFromAPrivateCollection"),this.form.removeControl("answers"),this.form.removeControl("blanks");let t=null;e&&(t=JSON.parse(e.contentAsJson)),this.form.addControl("isFromAPrivateCollection",new A.w({title:"Ngu\u1ed3n t\u1eeb",options:[{title:"Ri\xeang t\u1eebng t\u1eeb",value:!0},{title:"Nh\xf3m chung",value:!1}],order:3,formState:!!t&&t.isFromAPrivateCollection,events:{change:s=>{this.changeTypeOfCollection()}}})),this.form.addControl("question",new I.l({title:"C\xe2u h\u1ecfi",order:4,events:{change:(s,u)=>{this.changeTypeOfCollection()}},formState:t?t.question:""})),t&&t.isFromAPrivateCollection&&this.form.addControl("blanks",new v.G({title:"C\xe2u tr\u1ea3 l\u1eddi",columns:{position:new l.y({title:"V\u1ecb tr\xed",order:1}),answer:new l.y({title:"C\xe2u tr\u1ea3 l\u1eddi",order:2})},order:5,formState:t?t.blanks:[]}))}changeTypeOfCollection(){const t=this.form.controls.question;if(this.form.controls.isFromAPrivateCollection.value){const s=this.buildAnswersValueFromQuestionValue(t.value);this.addBlanks([]);const u=this.form.controls.blanks,r=u.value;t.value.match(/blank_[0->9]*\(/g),s.forEach(c=>{const h=r.findIndex(y=>y.position===c.position);h>=0?r[h].answer.indexOf(c.answer)<0&&(r[h].answer+=`,${c.answer}`):(u.addFormGroup(),r.push({position:c.position,answer:c.answer}))}),u.setValue(r)}else this.form.removeControl("blanks")}addBlanks(e){this.form.controls.blanks||this.form.addControl("blanks",new v.G({title:"Ch\u1ed7 \u0111i\u1ec1n",columns:{position:new l.y({title:"V\u1ecb tr\xed",order:1}),answer:new l.y({title:"C\xe2u tr\u1ea3 l\u1eddi",order:2})},order:4,formState:e}))}buildAnswersValueFromQuestionValue(e){const t=[],s=e.match(/blank_[0->9]*\(/g);function u(r){let c="";for(let h=e.indexOf(r);h<e.length;h++){const y=e.charAt(h);if("("===y)c="";else{if(")"===y)return c;c+=y}}return c}return s&&s.forEach(r=>{t.push({position:r.replace("(",""),answer:u(r)})}),t}}class B{constructor(e){this.form=e}getQuestionForCreating(){const e=this.form.value;return{name:e.name,contentAsJson:JSON.stringify({question:e.question,answers:e.answers}),sectionId:e.sectionId,type:e.type}}getQuestionForEditing(){const e=this.form.value;return{questionId:e.questionId,name:e.name,contentAsJson:JSON.stringify({question:e.question,answers:e.answers}),sectionId:e.sectionId,type:e.type}}changeForm(e){this.form.removeControl("question"),this.form.removeControl("isFromAPrivateCollection"),this.form.removeControl("answers"),this.form.removeControl("blanks");let t=null;e&&(t=JSON.parse(e.contentAsJson)),this.form.addControl("question",new I.l({title:"C\xe2u h\u1ecfi",order:3,formState:t?t.question:""})),this.form.addControl("answers",new v.G({title:"C\xe2u tr\u1ea3 l\u1eddi",columns:{from:new l.y({title:"B\u1eaft \u0111\u1ea7u",order:1,validatorOrOpts:a.kI.required}),target:new l.y({title:"K\u1ebft th\xfac",order:2,validatorOrOpts:a.kI.required})},order:4,formState:t?t.answers:[]}))}}class Z{constructor(e){this.form=e,this.isCorrectOptions=[{value:!0,title:"\u0110\xfang"},{value:!1,title:"Sai"}]}getQuestionForCreating(){const e=this.form.value;return{name:e.name,contentAsJson:JSON.stringify({question:e.question,answers:e.answers}),sectionId:e.sectionId,type:e.type}}getQuestionForEditing(){const e=this.form.value;return{questionId:e.questionId,name:e.name,contentAsJson:JSON.stringify({question:e.question,answers:e.answers}),sectionId:e.sectionId,type:e.type}}changeForm(e){this.form.removeControl("question"),this.form.removeControl("isFromAPrivateCollection"),this.form.removeControl("answers"),this.form.removeControl("blanks");let t=null;if(e){const s=JSON.parse(e.contentAsJson);t={questionId:e.questionId,name:e.name,sectionId:e.sectionId,type:e.type,question:s.question,answers:s.answers}}this.form.addControl("question",new I.l({title:"C\xe2u h\u1ecfi",order:3,formState:t?t.question:""})),this.form.addControl("answers",new v.G({title:"C\xe2u tr\u1ea3 l\u1eddi",columns:{answer:new l.y({title:"C\xe2u tr\u1ea3 l\u1eddi",order:1,validatorOrOpts:a.kI.required}),isCorrect:new A.w({title:"L\xe0 c\xe2u tr\u1ea3 l\u1eddi \u0111\xfang",options:this.isCorrectOptions,order:1,formState:!1,validatorOrOpts:a.kI.required})},formState:t?t.answers:[],order:4}))}}class ${constructor(e){this.form=e}getQuestionForCreating(){const e=this.form.value;return{name:e.name,contentAsJson:JSON.stringify({question:e.question,answers:e.answers}),sectionId:e.sectionId,type:e.type}}getQuestionForEditing(){const e=this.form.value;return{questionId:e.questionId,name:e.name,contentAsJson:JSON.stringify({question:e.question,answers:e.answers}),sectionId:e.sectionId,type:e.type}}changeForm(e){this.form.removeControl("question"),this.form.removeControl("isFromAPrivateCollection"),this.form.removeControl("answers"),this.form.removeControl("blanks");let t=null;e&&(t=JSON.parse(e.contentAsJson)),this.form.addControl("question",new I.l({title:"C\xe2u h\u1ecfi",order:3,formState:t?t.question:""})),this.form.addControl("answers",new v.G({title:"C\xe2u tr\u1ea3 l\u1eddi",columns:{answer:new l.y({title:"C\xe2u tr\u1ea3 l\u1eddi",order:1,validatorOrOpts:a.kI.required}),position:new l.y({title:"S\u1ed1 th\u1ee9 t\u1ef1",order:2,validatorOrOpts:a.kI.required})},order:4,formState:t?t.answers:[]}))}}var i=o(4650),N=o(9905),f=o(3421),H=o(5715);let q=(()=>{class n{constructor(t,s){this.router=t,this.questionsService=s,this.pageHelper=new d.M("/test/question"),this.questionHelper=null,this.formConfig={id:"questionForm",title:this.formTitle,buttons:this.buttons,form:new a.cw({questionId:new w.W(""),name:new l.y({title:"T\xean",order:1,validatorOrOpts:a.kI.required}),type:new k.i({title:"Ki\u1ec3u c\xe2u h\u1ecfi",options:D,order:2,formState:p.MultipleChoiceQuestion,events:{change:u=>{this.updateQuestionHelper(),this.questionHelper.changeForm()}},validatorOrOpts:a.kI.required}),sectionId:new w.W(this.sectionId)})}}get sectionId(){return new URL(location.href.replace("/#","")).searchParams.get("sectionId")}get questionId(){const t=location.href.split("?")[0].split("/");return t[t.length-1]}get formTitle(){return this.pageHelper.isCreatingPage?"Th\xeam c\xe2u h\u1ecfi":this.pageHelper.isDetailsPage?"Th\xf4ng tin c\xe2u h\u1ecfi":"S\u1eeda c\xe2u h\u1ecfi"}get buttons(){return[{title:"Quay l\u1ea1i ph\u1ea7n ki\u1ec3m tra",link:{url:`/test/section-details/${this.sectionId}`}},this.pageHelper.isEditingPage?{title:"Quay l\u1ea1i",link:{url:this.pageHelper.getDetailsPage(this.questionId),queryParams:{sectionId:this.sectionId}}}:null,{title:this.pageHelper.isCreatingPage?"Th\xeam":this.pageHelper.isDetailsPage?"S\u1eeda":"L\u01b0u",link:this.pageHelper.isDetailsPage?{url:this.pageHelper.getEditingPage(this.questionId),queryParams:{sectionId:this.sectionId}}:null,event:this.pageHelper.isDetailsPage?null:t=>this.submitEvent(t)}]}ngOnInit(){this.pageHelper.isCreatingPage?(this.updateQuestionHelper(),this.questionHelper.changeForm()):this.questionsService.getQuestion(this.questionId).subscribe(t=>{this.formConfig.form.setValue({questionId:t.questionId,name:t.name,type:t.type,sectionId:t.sectionId}),this.updateQuestionHelper(),this.questionHelper.changeForm(t),this.pageHelper.isDetailsPage&&this.formConfig.form.disable()})}submitEvent(t){this.createOrEditQuestion()}createOrEditQuestion(){this.pageHelper.isCreatingPage&&this.questionsService.createQuestion(this.questionHelper.getQuestionForCreating()).subscribe(t=>{this.router.navigate([this.pageHelper.getDetailsPage(t.questionId)],{queryParams:{sectionId:t.sectionId}})}),this.pageHelper.isEditingPage&&this.questionsService.updateQuestion(this.questionHelper.getQuestionForEditing()).subscribe(()=>{this.router.navigate([this.pageHelper.getDetailsPage(this.questionId)],{queryParams:{sectionId:this.sectionId}})})}updateQuestionHelper(){switch(+this.formConfig.form.controls.type.value){case p.MultipleChoiceQuestion:this.questionHelper=new Z(this.formConfig.form);break;case p.BlankFillingQuestion:this.questionHelper=new M(this.formConfig.form);break;case p.SortingQuestion:this.questionHelper=new $(this.formConfig.form);break;case p.MatchingQuestion:this.questionHelper=new B(this.formConfig.form)}}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(g.F0),i.Y36(N.w))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-question"]],decls:2,vars:1,consts:[[3,"config"]],template:function(t,s){1&t&&(i.TgZ(0,"app-layout"),i._UZ(1,"app-form",0),i.qZA()),2&t&&(i.xp6(1),i.Q6J("config",s.formConfig))},dependencies:[f.$,H.U],encapsulation:2}),n})();var P=o(1627);function E(n,e){if(1&n&&(i.ynx(0),i._UZ(1,"app-table",1),i.BQk()),2&n){const t=i.oxw();i.xp6(1),i.Q6J("config",t.tableConfig)}}function V(n,e){if(1&n&&(i.ynx(0),i.TgZ(1,"app-layout"),i._UZ(2,"app-table",1),i.qZA(),i.BQk()),2&n){const t=i.oxw();i.xp6(2),i.Q6J("config",t.tableConfig)}}let F=(()=>{class n{constructor(t){this.router=t,this.pageHelper=new d.M("/test/question"),this.tableConfig={title:"Danh s\xe1ch c\xe2u h\u1ecfi",url:"api/Test/Admin/Questions",buttons:[{title:"Th\xeam",link:{url:this.pageHelper.getCreatingPage()}}],columns:[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[questionId]")}}]}}ngOnInit(){this.sectionId&&(this.tableConfig.url=`api/Test/Admin/Questions?sectionId=${this.sectionId}`,this.tableConfig.buttons=[{title:"Th\xeam",link:{url:this.pageHelper.getCreatingPage(),queryParams:{sectionId:this.sectionId}}}],this.tableConfig.columns=[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[questionId]"),queryParams:{sectionId:this.sectionId}}}])}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(g.F0))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-questions"]],inputs:{sectionId:"sectionId"},decls:2,vars:2,consts:[[4,"ngIf"],[3,"config"]],template:function(t,s){1&t&&(i.YNc(0,E,2,1,"ng-container",0),i.YNc(1,V,3,1,"ng-container",0)),2&t&&(i.Q6J("ngIf",s.sectionId),i.xp6(1),i.Q6J("ngIf",!s.sectionId))},dependencies:[C.O5,f.$,P.a],encapsulation:2}),n})();var O=o(3454);function U(n,e){if(1&n&&i._UZ(0,"app-questions",2),2&n){const t=i.oxw();i.Q6J("sectionId",t.sectionId)}}let T=(()=>{class n{constructor(t,s,u){this.httpClient=t,this.router=s,this.testsService=u,this.pageHelper=new d.M("/test/section"),this.buttonBack={title:"Quay l\u1ea1i b\xe0i ki\u1ec3m tra",link:{url:`/test/test-details/${this.testId}`}},this.formTestId=new k.i({options:[],formState:this.testId,order:2,title:"B\xe0i ki\u1ec3m tra"}),this.formConfig={id:"sectionForm",title:this.formTitle,buttons:[this.buttonBack,this.pageHelper.isEditingPage?{title:"Quay l\u1ea1i",link:{url:this.pageHelper.getDetailsPage(this.sectionId)}}:null,{title:this.pageHelper.isCreatingPage?"Th\xeam":this.pageHelper.isDetailsPage?"S\u1eeda":"L\u01b0u",link:this.pageHelper.isDetailsPage?{url:this.pageHelper.getEditingPage(this.sectionId)}:null,event:this.pageHelper.isDetailsPage?null:r=>{if(this.pageHelper.isCreatingPage){const m=this.formConfig.form.value;m.sectionId=void 0,this.httpClient.post("api/Test/Admin/Sections",m).subscribe(c=>{this.router.navigate([this.pageHelper.getDetailsPage(c.data.sectionId)])})}this.pageHelper.isEditingPage&&this.httpClient.put(`api/Test/Admin/Sections/${this.sectionId}`,this.formConfig.form.value).subscribe(()=>{this.router.navigate([this.pageHelper.getDetailsPage(this.sectionId)])})}}],form:new a.cw({sectionId:new w.W(""),name:new l.y({title:"T\xean",order:1,validatorOrOpts:a.kI.required}),testId:this.formTestId})},this.testId=new URL(location.href.replace("/#","")).searchParams.get("testId")||"",this.formTestId.setValue(this.testId)}get isDetailsPage(){return this.pageHelper.isDetailsPage}get sectionId(){const t=location.href.split("?")[0].split("/");return t[t.length-1]}get formTitle(){return this.pageHelper.isCreatingPage?"Th\xeam ph\u1ea7n ki\u1ec3m tra":this.pageHelper.isDetailsPage?"Th\xf4ng tin ph\u1ea7n ki\u1ec3m tra":"S\u1eeda ph\u1ea7n ki\u1ec3m tra"}ngOnInit(){this.testsService.getTestsAsSelectOptions().subscribe(t=>{this.formTestId.params.options=t}),this.pageHelper.isCreatingPage||(this.httpClient.get(`api/Test/Admin/Sections/${this.sectionId}`).subscribe(t=>{this.testId=t.data.testId,this.formConfig.buttons[0].link&&(this.formConfig.buttons[0].link.url=`/test/test-details/${this.testId}`),this.formConfig.form.setValue(t.data)}),this.formTestId.disable()),this.pageHelper.isDetailsPage&&this.formConfig.form.disable()}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(S.eN),i.Y36(g.F0),i.Y36(O.$x))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-section"]],decls:3,vars:2,consts:[[3,"config"],[3,"sectionId",4,"ngIf"],[3,"sectionId"]],template:function(t,s){1&t&&(i.TgZ(0,"app-layout"),i._UZ(1,"app-form",0),i.YNc(2,U,1,1,"app-questions",1),i.qZA()),2&t&&(i.xp6(1),i.Q6J("config",s.formConfig),i.xp6(1),i.Q6J("ngIf",s.isDetailsPage))},dependencies:[C.O5,f.$,H.U,F],encapsulation:2}),n})();function Y(n,e){if(1&n&&(i.ynx(0),i._UZ(1,"app-table",1),i.BQk()),2&n){const t=i.oxw();i.xp6(1),i.Q6J("config",t.tableConfig)}}function G(n,e){if(1&n&&(i.ynx(0),i.TgZ(1,"app-layout"),i._UZ(2,"app-table",1),i.qZA(),i.BQk()),2&n){const t=i.oxw();i.xp6(2),i.Q6J("config",t.tableConfig)}}let x=(()=>{class n{constructor(t){this.router=t,this.pageHelper=new d.M("/test/section"),this.addSectionButton={title:"Th\xeam",link:{url:this.pageHelper.getCreatingPage()}},this.tableConfig={title:"Danh s\xe1ch ph\u1ea7n ki\u1ec3m tra",url:"api/Test/Admin/Sections",buttons:[this.addSectionButton],columns:[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[sectionId]")}}]}}ngOnInit(){this.testId&&(this.tableConfig.url=`api/Test/Admin/Sections?testId=${this.testId}`,this.tableConfig.columns=[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[sectionId]")}}],this.addSectionButton.link={url:this.pageHelper.getCreatingPage(),queryParams:{testId:this.testId}})}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(g.F0))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-sections"]],inputs:{testId:"testId"},decls:2,vars:2,consts:[[4,"ngIf"],[3,"config"]],template:function(t,s){1&t&&(i.YNc(0,Y,2,1,"ng-container",0),i.YNc(1,G,3,1,"ng-container",0)),2&t&&(i.Q6J("ngIf",s.testId),i.xp6(1),i.Q6J("ngIf",!s.testId))},dependencies:[C.O5,f.$,P.a],encapsulation:2}),n})();function L(n,e){if(1&n&&i._UZ(0,"app-sections",2),2&n){const t=i.oxw();i.Q6J("testId",t.testId)}}let b=(()=>{class n{constructor(t,s){this.router=t,this.testsService=s,this.pageHelper=new d.M("/test/test"),this.formConfig={id:"testForm",title:this.pageHelper.isCreatingPage?"Th\xeam b\xe0i ki\u1ec3m tra m\u1edbi":this.pageHelper.isDetailsPage?"Th\xf4ng tin b\xe0i ki\u1ec3m tra":"S\u1eeda b\xe0i ki\u1ec3m tra",buttons:[{title:"Danh s\xe1ch",link:{url:"/test/test-list"}},this.pageHelper.isEditingPage?{title:"Quay l\u1ea1i",link:{url:this.pageHelper.getDetailsPage(this.testId)}}:null,{title:this.pageHelper.isDetailsPage?"S\u1eeda":this.pageHelper.isEditingPage?"L\u01b0u":"Th\xeam",link:this.pageHelper.isDetailsPage?{url:this.pageHelper.getEditingPage(this.testId)}:null,event:this.pageHelper.isDetailsPage?null:u=>{const r=this.formConfig.form.value;this.pageHelper.isCreatingPage&&this.testsService.createTest({name:r.name,description:r.description}).subscribe(m=>{this.router.navigate([this.pageHelper.getDetailsPage(m.testId)])}),this.pageHelper.isEditingPage&&this.testsService.editTest({testId:r.testId,name:r.name,description:r.description}).subscribe(()=>{this.router.navigate([this.pageHelper.getDetailsPage(this.testId)])})}}],form:new a.cw({testId:new w.W(""),name:new l.y({title:"T\xean",order:1,validatorOrOpts:a.kI.required}),description:new I.l({title:"M\xf4 t\u1ea3",order:2})})}}get testId(){const t=location.href.split("/");return t[t.length-1]}get isDetailsPage(){return location.href.indexOf("/test/test-details/")>=0}ngOnInit(){this.pageHelper.isCreatingPage||this.testsService.getTest(this.testId).subscribe(t=>{this.formConfig.form.setValue(t)}),this.pageHelper.isDetailsPage&&this.formConfig.form.disable()}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(g.F0),i.Y36(O.$x))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-test"]],decls:3,vars:2,consts:[[3,"config"],[3,"testId",4,"ngIf"],[3,"testId"]],template:function(t,s){1&t&&(i.TgZ(0,"app-layout"),i._UZ(1,"app-form",0),i.YNc(2,L,1,1,"app-sections",1),i.qZA()),2&t&&(i.xp6(1),i.Q6J("config",s.formConfig),i.xp6(1),i.Q6J("ngIf",s.isDetailsPage))},dependencies:[C.O5,f.$,H.U,x],styles:["app-sections[_ngcontent-%COMP%]{margin-top:20px}"]}),n})();const X=[{path:"test-list",component:(()=>{class n{constructor(){this.pageHelper=new d.M("/test/test"),this.tableConfig={title:"Danh s\xe1ch b\xe0i ki\u1ec3m tra",url:"api/Test/Admin/Tests",buttons:[{title:"Th\xeam",link:{url:this.pageHelper.getCreatingPage()}}],columns:[{property:"name",title:"T\xean",text:"[name]",link:{url:this.pageHelper.getDetailsPage("[testId]")}}]}}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-test"]],decls:2,vars:1,consts:[[3,"config"]],template:function(t,s){1&t&&(i.TgZ(0,"app-layout"),i._UZ(1,"app-table",0),i.qZA()),2&t&&(i.xp6(1),i.Q6J("config",s.tableConfig))},dependencies:[f.$,P.a],encapsulation:2}),n})()},{path:"test-creating",component:b},{path:"test-details/:id",component:b},{path:"test-editing/:id",component:b},{path:"section-list",component:x},{path:"section-creating",component:T},{path:"section-details/:id",component:T},{path:"section-editing/:id",component:T},{path:"question-list",component:F},{path:"question-creating",component:q},{path:"question-details/:id",component:q},{path:"question-editing/:id",component:q}];let R=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[g.Bz.forChild(X),g.Bz]}),n})(),W=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[C.ez,R,J.u,S.JF]}),n})()}}]);